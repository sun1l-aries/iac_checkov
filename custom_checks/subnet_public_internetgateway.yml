---
metadata:
 name: "Ensure all subnets are not public and have connection to the Internet"
 id: "CKV2_AWS_1077"
 category: "NETWORKING"
definition:
    and:
        - cond_type: "attribute"
          resource_types:
          - "aws_subnet"
          attribute: "map_public_ip_on_launch"
          operator: "equals"
          value: "false"
        - cond_type: "connection"
          resource_types:
          - "aws_subnet"
          connected_resource_types:
          - "aws_route_table"
          operator: "exists"
        - cond_type: "attribute"
          resource_types:
          - "aws_route_table"
          attribute: "route.cidr_block"
          operator: "equals"
          value: "0.0.0.0/0"
        - cond_type: "attribute"
          resource_types:
          - "aws_route_table"
          attribute: "route.gateway_id"
          operator: "contains"
          value: "*igw*"